<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hammed Akande">
<meta name="dcterms.date" content="2023-10-16">

<title>Intro to SPSS-EDUC_806 - EDUC_806- Quantitative Research Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Intro to SPSS-EDUC_806</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-4--regression" id="toc-chapter-4--regression" class="nav-link active" data-scroll-target="#chapter-4--regression">Chapter 4- Regression</a>
  <ul class="collapse">
  <li><a href="#simple-linear-regression-slr" id="toc-simple-linear-regression-slr" class="nav-link" data-scroll-target="#simple-linear-regression-slr">Simple Linear Regression (SLR)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EDUC_806- Quantitative Research Methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hammed Akande </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 16, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="chapter-4--regression" class="level1">
<h1>Chapter 4- Regression</h1>
<section id="simple-linear-regression-slr" class="level3">
<h3 class="anchored" data-anchor-id="simple-linear-regression-slr">Simple Linear Regression (SLR)</h3>
<p>During Tutorial 2 &amp; 3 (“Model Terminology”), I explained that Linear model and Linear regression are just synonyms and we often use either terms when quantifying the effect of a "<strong>continuous"</strong> independent variable on a"<strong>continuous"</strong> dependent (response) variable. The difference between this and ANOVA is that <strong>ANOVA</strong> is usually used when quantifying the effect of a "<strong>discrete (or categorical)"</strong> independent variable on a"<strong>continuous"</strong> dependent variable. So, it is important to note that- <em>ANOVA is also a linear regression!</em> In fact, if you run "anova" function on linear model object, you'll most likely get the same p-value.</p>
<p><strong>Regression</strong> generally refers to the fact that we are quantifying the relationship between a response variable and (one or more) predictor variables. In the case of <strong>SLR</strong>, both the response and the predictor are <em>numeric</em> variables and we are using a single predictor (independent) variable. Later we will use multiple predictor variables (multiple regression). Also, this models tells us that our model for Y is a linear combination of the predictors X. (In this case just one predictor)! For now, this always results in a model that is a line, but this is not always the case (and we may see this later on in the semester).</p>
<p>Like ANOVA, in SLR, we often talk about the assumptions that this model makes. This include-</p>
<ol type="1">
<li>Linearity- the relationship between Y and x is linear, of the form <span class="math inline">\(\beta_0 + \beta_1x\)</span>.</li>
<li>Independent. The errors <span class="math inline">\(\epsilon\)</span> are independent.</li>
<li>Normality. The errors, <span class="math inline">\(\epsilon\)</span> are normally distributed. I.e. the "error" around the line follows a normal distribution.</li>
<li>Equality of Variance. At each value of x, the variance of Y is the same.</li>
</ol>
<p>For this lab, we will be using a year dataset on Corvettes sales in Virginia Beach, Virginia. Using this data, ten Corvettes (between 1 and 6yrs old) were randomly selected and the below data shows the sales price (in hundreds of dollars) denoted by y and the age (in years) denoted by x.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Corvettes-01.PNG" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="tasks" class="level4">
<h4 class="anchored" data-anchor-id="tasks">Tasks</h4>
<ol type="1">
<li>Graph the data in a scatterplot to determine if there is a possible linear relationship.</li>
<li>Compute and interpret the linear correlation coefficient, r.</li>
<li>Determine the regression equation for the data.</li>
<li>Graph the regression equation and the data points.</li>
<li>Identify outliers and potential influential observations.</li>
<li>Compute and interpret the coefficient of determination, r2.</li>
<li>Obtain the residuals and create a residual plot. Decide whether it is reasonable to consider that the assumptions for regression analysis are met by the variables in questions.</li>
<li>At the 5% significance level, do the data provide sufficient evidence to conclude that the slope of the population regression line is not 0 and, hence, that age is useful as a predictor of sales price for Corvettes?</li>
<li>Obtain and interpret a 95% confidence interval for the slope, β, of the population regression line that relates age to sales price for Corvettes.</li>
<li>Obtain a point estimate for the mean sales price of all 4-year-old Corvettes.</li>
<li>Determine a 95% confidence interval for the mean sales price of all 4-year-old Corvettes.</li>
<li>Find the predicted sales price of Jack Smith's 4-year-old Corvette.</li>
<li>Determine a 95% prediction interval for the sales price of Jack Smith's 4-year-old Corvette.</li>
</ol>
<p>To begin, open your SPSS and load in the Corvettes_data. You can download it <a href="https://drive.google.com/file/d/1Hk_w8GMsFSajXT4sj57zhzax1oCm1zew/view?usp=drive_link">here</a>. if for anything that doesn’t work, you can manually enter the two variables in the SPSS.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Corv_data.PNG" class="img-fluid figure-img"></p>
</figure>
</div>
<p><em>1. To graph the data in a scatterplot and determine if there is a possible linear relationship</em>.</p>
<p>Select Graphs &gt; Scatter/Dot &gt; select Simple, then click the Define button. The Y-axis should be the Price and the X Axis variable = Age. &nbsp;Click on "Titles" and you can enter a descriptive title for your graph, and click "Continue." Click "OK".</p>
<p><em>Your graph should look similar to the figure below</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Price vs Age.PNG" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Interpretation- <strong>The points seem to follow a linear pattern, although with a negative slope</strong>.</p>
<ol start="2" type="1">
<li><p>To compute the linear correlation coefficient,</p>
<p>Click on “Analyze” &gt; “Correlate” &gt; “Bivariate”. Select “Age” and “Price” as the variables and select “Pearson” as the correlation coefficient. Finally, you can run the analysis.</p>
<p><img src="images/correlation_output.PNG" class="img-fluid"></p>
<p>The Pearson Correlation is a statistical method that calculates the strength and direction of linear relationships between continuous variables. It produces a sample correlation coefficient, r, which can be used to evaluate whether there is a linear relationship among the same variables in the population. This population correlation coefficient is represented by ρ (“rho”) and is a parametric measure.</p>
<p>Pearson correlation indicates:</p>
<ul>
<li><p>Whether there is a statistically significant linear relationship between two continuous variables</p></li>
<li><p>It also shows the strength of this linear relationship (i.e., how close the relationship is to being a perfectly straight line)</p></li>
<li><p>Finally, it reveals the direction of this linear relationship (increasing or decreasing)</p></li>
</ul>
<p>It is however important to note that Pearson Correlation cannot address non-linear relationships or relationships among categorical variables. To address relationships that involve categorical variables and/or non-linear relationships, you need to consider the equivalent non-parametric test (e.g., Spearman’s rank correlation).</p>
<p>Also, while Pearson Correlation reveals <em>associations</em> among (continuous) variables, you should remember that “<em>Correlation</em> <em>does not imply causation,</em>” no matter how large the correlation coefficient is.</p>
<p><strong>Interpretation</strong>- The correlation coefficient (as indicated in the upper-right figure), is <strong>-0.968</strong>. This r-value indicates a robust negative linear correlation, given its proximity to -1 and negative sign. This strong negative linear correlation suggests that data points should closely cluster around a downward-sloping regression line, (<em>which aligns with the graph above</em>). Consequently, the presence of a strong negative linear relationship between Age and Price supports the continuation of linear regression analysis.</p></li>
<li><p>Regression equation for the data.</p>
<p>Because our goal here is to predict the price of 4-year-old Corvettes, let's modify the data variable before we proceed. Under the "Age" variable, enter the number "4" after the last row. Also, at the last row of the "Price" variable, enter a dot "." This way, we're telling SPSS that we want a prediction for this value and not to include the value in any other computations.</p>
<p><img src="images/Cor_pred_data.PNG" class="img-fluid"></p>
<p>Select Analyze &gt; Regression &gt; Linear. Select "Price" as the dependent variable and "Age" as the independent variable. Click "Statistics," select "Estimates" and "Confidence Intervals" for the regression coefficients, select "Model fit" to obtain r2, and click "Continue."</p>
<p>Click "Plots," select "Normal Probability Plot" of the residuals and click "Continue." Click "Save," select "Unstandardized" predicted values, select "Unstandardized" and "Studentized" residuals, select "Mean" (to obtain a confidence interval output in the Data Window) and "Individual" (to obtain a prediction interval output in the Data Window) at the 95% level, and click "Continue." &nbsp;Finally, click "OK" to run the analysis.</p>
<p><img src="images/regression_equation_output.PNG" class="img-fluid"></p>
<p>From above, the regression equation is: Price = 29160.194 – (2790.291)(Age). So what if a newly sold Corvettes was 10years old? What would be the price? <em>Y</em> = 29160.194 – (2790.291)(10) which equals ~ $1257.284.</p></li>
<li><p>Graph the regression equation and the data points</p>
<p>Another way to visualize our regression line is through a scatterplot. Click on <strong>Graphs</strong>, then <strong>Scatter/Dot</strong>. In the Scatter/Dot dialog box that appears, be sure "Simple Scatter" is selected and then click&nbsp;<strong>Define</strong>. Move "Price" to the "Y Axis" box and move "Age" to the "X Axis" box and then click&nbsp;<strong>OK</strong>. A simple scatterplot should appear in your Output Viewer window. Double click the graph to show the "Chart Editor" window. Now, click&nbsp;<strong>Elements</strong> and then click&nbsp;<strong>Fit Line at Total</strong>. Now your scatterplot displays the linear regression line computed above while also providing you with the regression equation and the R squared value. This is a good way to double-check that we've written our equation correctly.</p>
<p><img src="images/regression_plot.PNG" class="img-fluid"></p></li>
<li><p>Identify the Outliers and potential influential observations</p>
<p>From the plot, there seem to be no points that lie far from the cluster of data points or far from the regression line; thus, no possible outliers.</p></li>
<li><p>Compute and interpret the coefficient of determination, r<sup>2</sup>.</p>
<p><img src="images/model_summary_r2.PNG" class="img-fluid"></p>
<p>The r<sup>2</sup> = 0.937; therefore, about 93.7% of the variation in the price data is explained by age. I.e., as the car gets older, the value/price drops! &nbsp;The regression equation appears to be very useful for making predictions since the value of r<sup>2</sup> is close to 1.</p>
<p>Note- we also have adjusted R-square. R-square technically measures the variation of a regression model (variation in Y given x). R-squared either increases or remains the same when new predictors are added to the model. Adjusted R-squared measures the variation for a multiple regression model, and helps you determine goodness of fit. For the purpose of this SLR (one predictor, we are not adding more), so we can decide to intepret any of them. But if you have multiple predictors, you may want to look into Adj. R2)!</p></li>
<li><p>Residuals</p>
<p>The residuals, predicted values and confidence intervals can be found in the data window.</p>
<p><img src="images/Residuals-02.PNG" class="img-fluid"></p>
<p>To create a residual plot, select Graphs&gt; Scatter/Dot&gt;Simple. Select &nbsp;the residuals (RES_1) as the Y Axis variable and Age as the X Axis variable. Click "Titles" to enter "Residual Plot" as the title for your graph, and click "Continue". Click "OK".</p>
<p>Double-click the resulting graph in the output window, select "Options" &gt; "Y Axis Reference Line", select the "Reference Line" tab in the properties window, add position of line "0", and click "Apply". Click the close box to exit the chart editor.</p>
<p><img src="images/Residual_plot-02.PNG" class="img-fluid"></p>
<p>Do the same scatter plot to create a studentized residual plot. Select the SRES as the Y axis in this case (Age remains the X axis). Set the title and enter “Studentized Residual Plot”.</p>
<p><img src="images/studentized_regression_plot-02.PNG" class="img-fluid"></p>
<p><strong>Also, to assess the normality of the residuals, consult the P-P Plot from the regression output.</strong></p>
<p><img src="images/normal_p-p_plot-02.PNG" class="img-fluid"></p>
<p><strong>Interpretation</strong>- The residual plot shows a random scatter of the points (independence) with a constant spread (variance). Also, the studentized residual plot shows a random scatter of the points (independence) with a constant variance and with no values beyond the ±2 standard deviation reference lines (no outliers). The normal probability plot of the residuals shows the points close to a diagonal line; therefore, the residuals appear to be approximately normally distributed. Thus, we have evidence to conclude that the assumptions for regression analysis appear to be met.</p></li>
<li><p>Question - <em>Using 5% significance level, do the data provide sufficient evidence to conclude that the</em></p>
<p><em>slope of the population regression line is not 0 and, hence, that age is useful as a predictor</em></p>
<p><em>of sales price for Corvettes</em>?</p>
<p>Here, we need to state the hypothesis. The hypothesis from the question above is that-</p>
<p><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\beta = 0\)</span> (Age is not a useful predictor of price.)</p>
<p><span class="math inline">\(H_a\)</span>: <span class="math inline">\(\beta \neq 0\)</span> (Age is a useful predictor of price.)</p>
<p>Now that we’ve done that, remember our alpha = 0.05 and our critical value or rejection region is that we should reject the null hypothesis if alpha is less than 0.05. Finally, to answer the question, you can choose your test Statistic (choose either the T-test method or the F-test method- not both!). Check the regression output and see the “coefficient”. From the result of the regression, you can see that T = –10.887, and p-value = &lt;0.001</p>
<p><img src="images/regression_coeff.PNG" class="img-fluid"></p>
<p><strong>Interpretation</strong>- Since the P-value &lt; 0.05, we have evidence to reject the null hypothesis. In other words, we have enough evidence to conclude that the slope of the population regression line is not zero. In other words, age is a useful predictor of price for Corvettes.</p></li>
<li><p><em>Obtain and interpret a 95% confidence interval for the slope, β , of the population regression line that relates age to sales price for Corvettes.</em></p>
<p>Look at the regression coefficient above, We are 95% confident that the slope of the true regression line is somewhere between –3381.295 and –2199.288. In other words, we are 95% confident that for every year older Corvettes get, their average price decreases somewhere between $3,381.295 and $2,199.288.</p></li>
<li><p><em>Obtain a point estimate for the mean sales price of all 4-year-old Corvettes.</em></p>
<p>Look at the data window (last row), the point estimate (PRE_1) is 17999.02913 dollars ($17,999.02913).</p></li>
<li><p><em>Determine a 95% confidence interval for the mean sales price of all 4-year-old Corvettes.</em></p>
<p>Still on the last row of the data table, we are 95% confident that the mean sales price of all four-year-old Corvettes is somewhere between $16,958.46042 (LMCI_1) and $19,039.59783 (UMCI_1).</p></li>
<li><p><em>Find the predicted sales price of Jack Smith's selected 4-year-old Corvette</em>.</p>
<p>The predicted sales price is 17999.02913 dollars ($17,999.02913).</p></li>
<li><p><em>Determine a 95% prediction interval for the sales price of Jack Smith's 4-year-old</em></p>
<p><em>Corvette.</em></p>
<p>We are 95% certain that the individual sales price of Jack Smithʼs Corvette will be</p>
<p>somewhere between $14,552.91726 (LICI_1) and $21,445.14099 (UICI_1).</p></li>
</ol>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>